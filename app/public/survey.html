<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>HOME FriendFinder</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="jumbotron bg-warning">
                <h1 class="display-3 text-center">Survey Questions</h1>
            </div>
            <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <h3>About You</h3>
                            <form role="form">
                                <div class="form-group">
                                    <label for="friendName"><h4>Name(required)</h4></label>
                                    <input type="text" class="form-control" id="friendName">
                                </div>
                                <div class="form-group">
                                    <label for="friendSocial"><h4>Link to Photo(Required)</h4></label>
                                    <input type="text" class="form-control" id="friendLink">
                                </div>
                            </form>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <form role="form">
                                    <div class="form-group">
                                        <label for="Q1"><p><h3>Question 1</h3><h4>Swimming in the ocean is better than swimming in a public pool.</h4></p></label>
                                        <br>
                                        <select id="q1" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q2"><p><h3>Question 2</h3><h4>It is OK to lie in order to protect someone's feelings.</h4></p></label>
                                        <br>
                                        <select id="q2" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q3"><p><h3>Question 3</h3><h4>Myspace was better than Facebook.</h4></p></label>
                                        <br>
                                        <select id="q3" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q4"><p><h3>Question 4</h3><h4>Smoking should be banned worldwide.</h4></p></label>
                                        <br>
                                        <select id="q4" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q5"><p><h3>Question 5</h3><h4>We do not really need religion.</h4></p></label>
                                        <br>
                                        <select id="q5" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q6"><p><h3>Question 6</h3><h4>You enjoy having a wide circle of acquaintances.</h4></p></label>
                                        <br>
                                        <select id="q6" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q7"><p><h3>Question 7</h3><h4>You feel that the world is founded on compassion.</h4></p></label>
                                        <br>
                                        <select id="q7" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q8"><p><h3>Question 8</h3><h4>You believe the best decision is one which can be easily changed.</h4></p></label>
                                        <br>
                                        <select id="q8" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q9"><p><h3>Question 9</h3><h4>You trust reason rather than feelings.</h4></p></label>
                                        <br>
                                        <select id="q9" class="custom-select">
                                            <option value ="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Q10"><p><h3>Question 10</h3><h4>You are a person somewhat reserved and distant in communication.</h4></p></label>
                                        <br>
                                        <select id="q10" class="custom-select">
                                            <option value="0" selected>Select an Option</option>
                                            <option value="1">1 (Strongly Agree)</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5 (Strongly Disagree)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <button id= "submit"class="btn btn-primary btn-lg btn-block" ><span class="glyphicon glyphicon-ok-sign"></span> Submit</button>
                                    </div>
                                </form>    
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- The Modal -->
            <div class="modal fade" id="myModal">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
      
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Your Match</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <!-- Modal body -->
                        <div id="modalBody" class="modal-body">
                        </div>
                    </div>
                </div>
            </div>
            <p><a href="/api/friends">API Friend List</a> | <a href="https://github.com/perlaballesteros/FriendFinder">GITHub Repo</a></p>
        </div>
    </body>
</html>
<script type="text/javascript">

    function popUp(matchName,matchPhoto){
        var matchInfo=$("<div>");
        $("#modalBody").append(matchInfo);
        var matchNameDisplay="<h3 style='text-align:center';'>"+matchName+"</h3>"
        matchInfo.append(matchNameDisplay);
        var img="<div><center><img src="+matchPhoto+" alt='photo' height='200' width='200'></center></div>"
        matchInfo.append(img);
        $('#myModal').modal("show");
    }
    function findMatches(matchIndxs,friends){
        for (var i=0;i<matchIndxs.length;i++){
            var matchName=friends[matchIndxs[i]].name;
            var matchPhoto=friends[matchIndxs[i]].photo;
            popUp(matchName,matchPhoto);
        }
            
    }
    function matchIndexes(diffArray,friends){
        var smallestDiff=Math.min.apply(null,diffArray);
        var matchIndxs = [];
        for (var i=0;i<diffArray.length;i++) {
            if (diffArray[i] === smallestDiff) {
                matchIndxs.push(i);
            }
        }
        findMatches(matchIndxs,friends);
    }
    function calcDiffs(friends){
        var diffArray=[];
        var friendsLength=friends.length;
        var scoresLength=10;

            for(var i=0;i<friendsLength-1;i++){
                var sumofdiffs=0;
                for(var j=0;j<scoresLength;j++){
                    var friendI=parseInt(friends[i].scores[j]);
                    var recentlyAddedfriend=parseInt(friends[friendsLength-1].scores[j]);
                    var diff=Math.abs(recentlyAddedfriend-friendI);
                    sumofdiffs=diff+sumofdiffs;
                }
                diffArray.push(sumofdiffs);
            }
            
        matchIndexes(diffArray,friends);

    }
    function accessApi(){
        var currentURL = window.location.origin;
        console.log(currentURL+"/api/friends");
        $.ajax({ url: currentURL + "/api/friends", method: "GET" }).then(function(friends) {
            calcDiffs(friends);
        });
    }

    $("#submit").on("click", function(event) {
        event.preventDefault();
     
        var newFriend = {
            name:$("#friendName").val().trim(),
            photo:$("#friendLink").val().trim(),
            scores:[$("#q1 :selected").val(),
                $("#q2 :selected").val(),
                $("#q3 :selected").val(),
                $("#q4 :selected").val(),
                $("#q5 :selected").val(),
                $("#q6 :selected").val(),
                $("#q7 :selected").val(),
                $("#q8 :selected").val(),
                $("#q9 :selected").val(),
                $("#q10 :selected").val()
            ]
        };

        var emptyAnsws=10;
        for(var i=0; i<newFriend.scores.length;i++){
            if(newFriend.scores[i]!=="0"){
                emptyAnsws--;
            }
        }
        if(emptyAnsws===0 && newFriend.name!==" " && newFriend.link!==" "){
            $.post("/api/friends", newFriend,function(){});
            $("#modalBody").empty();
            accessApi();
        }
        else{
            alert("Please fill out all fields before submitting!");
        }   
    });
    
</script>